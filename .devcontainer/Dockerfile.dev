FROM node:25-bookworm

RUN apt-get update && apt-get install -y \
    git curl wget jq vim \
    && rm -rf /var/lib/apt/lists/*

# pnpm setup (corepack removed from Node.js 25+)
ENV PNPM_HOME="/home/node/.local/share/pnpm"
ENV PATH="$PNPM_HOME:$PATH"
# Disable Corepack download prompt for non-interactive use
ENV COREPACK_ENABLE_DOWNLOAD_PROMPT=0

# Install corepack and prepare pnpm as root first
RUN npm install -g --force corepack && corepack enable

# Switch to node user and prepare pnpm in user context
USER node
RUN corepack prepare pnpm@9.15.0 --activate

WORKDIR /workspace
CMD ["sleep", "infinity"]
