# Spec: Deep Ping Page

## Overview

Web フロントエンドからバックエンド API への疎通確認（Deep Ping）を実行し、結果を表示するページを追加する。

「Deep Ping」とは、単純なヘルスチェック（`/health`）とは異なり、バックエンドが依存するサービス（データベース等）への接続確認も含めた、より詳細な疎通確認を指す。

## Functional Requirements (FR)

### FR-001: Deep Ping エンドポイント

バックエンド API に `/ping/deep` エンドポイントを追加する。

- HTTP GET リクエストを受け付ける
- バックエンドサーバー自体の状態を返す
- データベース接続の状態を確認して返す
- 各チェック項目の応答時間（レイテンシ）を計測して返す

### FR-002: Deep Ping ページ

Web フロントエンドに `/ping` ページを追加する。

- 「Ping」ボタンをクリックするとバックエンドの `/ping/deep` を呼び出す
- 結果をリアルタイムで画面に表示する
- 各チェック項目の状態（成功/失敗）とレイテンシを表示する
- エラー時は適切なエラーメッセージを表示する

### FR-003: 自動リフレッシュ（オプション）

- 自動リフレッシュのトグルを設ける
- 有効時は一定間隔（例: 5秒）で自動的に ping を実行する

## Non-Functional Requirements (NFR)

### NFR-001: Performance

- Deep Ping の応答時間は通常時 500ms 以内
- タイムアウトは 5 秒に設定

### NFR-002: Security

- Deep Ping エンドポイントは認証不要（Public）
- ただし、内部実装の詳細（接続文字列等）は漏洩させない

### NFR-003: Availability

- バックエンドダウン時もフロントエンドはエラーを適切に表示する
- 部分的な障害（DB のみダウン等）も検知・表示できる

## Acceptance Criteria (AC)

### AC-001: Deep Ping エンドポイントが応答する

**Given** バックエンドサーバーが起動している
**When** `GET /ping/deep` にリクエストを送信する
**Then** JSON レスポンスが返り、`status` フィールドが `"ok"` または `"degraded"` または `"error"` である

### AC-002: レイテンシが計測される

**Given** バックエンドサーバーが起動している
**When** `GET /ping/deep` にリクエストを送信する
**Then** レスポンスに各チェック項目の `latencyMs` が含まれる

### AC-003: フロントエンドから ping を実行できる

**Given** フロントエンドの `/ping` ページを開いている
**When** 「Ping」ボタンをクリックする
**Then** バックエンドへの疎通結果が画面に表示される

### AC-004: エラー時のハンドリング

**Given** バックエンドサーバーが停止している
**When** フロントエンドから ping を実行する
**Then** エラーメッセージが表示され、アプリケーションはクラッシュしない

### AC-005: 部分的な障害の検知

**Given** データベースのみ接続できない状態である
**When** `GET /ping/deep` にリクエストを送信する
**Then** `status` が `"degraded"` となり、DB チェックが `"error"` と表示される

## Out of Scope

- 認証が必要なヘルスチェック
- 外部サービス（Redis、メッセージキュー等）の疎通確認
- メトリクス収集・アラート連携
- 詳細なパフォーマンスダッシュボード

## Assumptions

- データベースは Prisma 経由で接続している
- バックエンド API は Node.js + TypeScript で実装されている
- フロントエンドは Next.js + React で実装されている
- 既存の `/health` エンドポイントは単純な生存確認のみ（依存サービスのチェックなし）
