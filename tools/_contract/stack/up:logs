#!/usr/bin/env bash
# Contract: up:logs - View development environment logs
set -euo pipefail

REPO_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/../../.." && pwd)"
cd "${REPO_ROOT}"

# Load .env (contains WORKTREE and REPO_NAME)
if [[ -f .env ]]; then
    # shellcheck source=/dev/null
    source .env
fi
export WORKTREE="${WORKTREE:-main}"
export REPO_NAME="${REPO_NAME:-}"

if docker compose version &>/dev/null; then
  COMPOSE_CMD="docker compose"
else
  COMPOSE_CMD="docker-compose"
fi

# Pass service name if provided, otherwise show all
SERVICE="${1:-}"

if [[ -n "${SERVICE}" ]]; then
  ${COMPOSE_CMD} -f docker-compose.worktree.yml logs -f "${SERVICE}"
else
  ${COMPOSE_CMD} -f docker-compose.worktree.yml logs -f
fi
