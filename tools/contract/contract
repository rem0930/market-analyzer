#!/usr/bin/env bash
#
# Golden Commands - Node.js + TypeScript (pnpm workspace)
#
set -euo pipefail

cmd="${1:-}"
if [[ -z "${cmd}" ]]; then
  echo "usage: ./tools/contract <command> [args...]"
  echo ""
  echo "commands:"
  echo "  format       - フォーマット（自動修正）"
  echo "  lint         - 静的解析"
  echo "  typecheck    - 型チェック"
  echo "  test         - ユニットテスト"
  echo "  build        - ビルド"
  echo "  guardrail    - ガードレールチェック"
  echo "  e2e          - E2Eテスト"
  echo "  migrate      - DBマイグレーション"
  echo "  deploy-dryrun - デプロイドライラン"
  echo "  dev          - 開発サーバー起動（docker-compose）"
  echo "  dev:stop     - 開発サーバー停止"
  echo "  dev:logs     - 開発サーバーログ表示"
  exit 2
fi

REPO_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/../.." && pwd)"
cd "${REPO_ROOT}"

script="tools/contract/stack/${cmd}"

if [[ ! -f "${script}" ]]; then
  echo "ERROR: Contract script not found for command '${cmd}'"
  echo "Available commands:"
  ls -1 tools/contract/stack 2>/dev/null || echo "  (none found)"
  exit 2
fi

if [[ ! -x "${script}" ]]; then
  chmod +x "${script}"
fi

exec "${script}" "${@:2}"
