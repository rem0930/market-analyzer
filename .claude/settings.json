{
  "$schema": "https://claude.ai/schemas/settings.json",
  "_comment": "Layer B (Defense): Security guardrails - DO NOT MODIFY deny rules",
  "_rules_comment": "Rules in .claude/rules/ are always auto-applied (01-core, 02-backend, 03-frontend, 04-security, 05-quality)",

  "permissions": {
    "allow": [
      "// === Safe Read-Only Commands (for background subagents) ===",
      "Bash(./tools/contract lint:*)",
      "Bash(./tools/contract typecheck:*)",
      "Bash(./tools/contract test:*)",
      "Bash(./tools/contract build:*)",
      "Bash(./tools/contract format:*)",
      "Bash(./tools/contract guardrail:*)",
      "Bash(git status:*)",
      "Bash(git diff:*)",
      "Bash(git log:*)",
      "Bash(pnpm audit:*)",
      "Bash(pnpm outdated:*)"
    ],
    "deny": [
      "// === Secrets & Credentials (File Access) ===",
      "Read(**/.env)",
      "Read(**/.env.*)",
      "Read(**/.env.local)",
      "Read(**/secrets/**)",
      "Read(**/*.pem)",
      "Read(**/*.key)",
      "Read(**/*.p12)",
      "Read(**/*.pfx)",
      "Read(**/credentials*)",
      "Read(**/*secret*)",
      "Read(**/*credential*)",

      "Edit(**/.env)",
      "Edit(**/.env.*)",
      "Edit(**/.env.local)",
      "Edit(**/secrets/**)",
      "Edit(**/*.pem)",
      "Edit(**/*.key)",

      "Write(**/.env)",
      "Write(**/.env.*)",
      "Write(**/.env.local)",
      "Write(**/secrets/**)",
      "Write(**/*.pem)",
      "Write(**/*.key)",

      "// === Destructive Shell Commands ===",
      "Bash(rm -rf /*)",
      "Bash(rm -rf ~/*)",
      "Bash(rm -rf ./*)",
      "Bash(sudo *)",

      "// === Remote Code Execution ===",
      "Bash(curl * | bash*)",
      "Bash(curl * | sh*)",
      "Bash(wget * | bash*)",
      "Bash(wget * | sh*)",
      "Bash(eval *)",

      "// === Secrets Exfiltration ===",
      "Bash(cat */.env*)",
      "Bash(cat */secrets/*)",
      "Bash(echo $*_KEY*)",
      "Bash(echo $*_SECRET*)",
      "Bash(echo $*_TOKEN*)",
      "Bash(echo $*_PASSWORD*)",
      "Bash(echo $*_API_KEY*)",
      "Bash(printenv *KEY*)",
      "Bash(printenv *SECRET*)",
      "Bash(printenv *TOKEN*)",
      "Bash(export *=* > *)",
      "Bash(env > *)",

      "// === Git Dangerous Operations ===",
      "Bash(git push --force*)",
      "Bash(git push -f*)",
      "Bash(git reset --hard*)",
      "Bash(git clean -fd*)"
    ]
  },

  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "$CLAUDE_PROJECT_DIR/.claude/hooks/pre-bash.sh",
            "timeout": 5
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "$CLAUDE_PROJECT_DIR/.claude/hooks/post-edit.sh",
            "timeout": 30
          }
        ]
      }
    ]
  }
}
